os: linux
dist: xenial

language: node_js

node_js:
  - "10.15.3"
  
addons:
  apt:
    update: true
    packages:
      - libgconf-2-4
      - libxss1
      - libappindicator1
      - libindicator7
  sonarcloud:
    organization: "estefafdez"
    token:
      secure: "XWFVCYA7HHN/iiavSBmZzjRDMIpXCO7JsTnfmG5DzvVxG9QN9bBG8Drc83oNh4OTvj/1Im9wZ6acioofv76tWuaNmg2pfTHblg4kBflvy5hQiP1wAo0HugTxxlOW5vqqE48U8HVU27CztxdDbFG0ixv4F0n0dZ0MwgWzEyO5GVqYejlluMt1+gJle/2vhIzDGGwMS08/b5LqNPGWabVt1vRLoHSvzczwkaeXe3L9zYiRZggJAvDNtomumKShuEgyGxSS08OgFOZ8w0NQJ7eBTe9rCLG+/68pSIcd3jJ0Xk5e5zPM+sFzp1E4fiYTh/vQjzfhgUqV/mxozORBiLL6oE6o6d6NdPg37Po7d81zH8d2GAzM8hWUtxLF42x3UWfZT9bz4fSxdjgLf0Rx1ZL5lTLu6xGGAWqMWF6dag4z2yHOOabmwKS4RVdyRnhJgEKmiermmPqcTejfCWkQ9bKBHe5t2R1ZSNdsY/DJNO9ZduKQQR1nGO6Bpc2uDOzoWlzemhXBOzreBLi1NtBol/tiC3IAjDYyQInTlFGhP2VuAsy/fnbGAA7dNmwP+Z5CWEPBrKrqS4zg3rVeTRKouG4m4vDAb7yS0nQog+gNEaWSFqTJf3rW1l590RQL3PYOvyzWeMCdB+rX/t0h7lZKw2KfS635WaLOTmLUQcboImraidE="

before_install:
  # Setup Microsoft Repository
  - curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
  - sudo install -o root -g root -m 644 microsoft.gpg /etc/apt/trusted.gpg.d/
  - sudo sh -c 'echo "deb [arch=amd64] https://packages.microsoft.com/repos/edge stable main" > /etc/apt/sources.list.d/microsoft-edge-dev.list'
  - sudo rm microsoft.gpg
  - sudo apt-get update
  - sudo apt install microsoft-edge-dev
  
cache:
  # cache both npm modules and Cypress binary
  directories:
  - ~/.npm
  - ~/.cache

before_script:
  # Check Chrome version:
  - google-chrome --version

  # Check Firefox version:
  - firefox --version

  # Check Microsoft Edge Version:
  - microsoft-edge-dev --version  

script:
  # Run Cypress
  - npm install
  - npm run verify
  - npm run test
  - sonar-scanner

after_script:
  # Create mochawesome report and json to get the results
  - npm run merge_reports
  - npm run generate_mochawesome_report
  
  # Display the results:
  - chmod +x script/results.sh
  - ./script/results.sh 

after_success:
  - kill $(jobs -p) || true

notifications:
  email:
    recipients:
      - estefafdez@gmail.com
    on_success: always 
    on_failure: always 

  slack:
    - rooms:
      - secure: mEKmNXyP8jEUJBhyN/ydvzSHKnFMTD7dGBvr02a3NGYqPIxOfgXnZYdoZY/WR6879j/92OCMoy6Jn3T+3/zqADShYwMkAUfiP1DOLE8tAO0rCHBtlNvhKRmJen4l7GWukfHP7Bb2ueYf9SWrPWfx8VNYeeaTAcLZeUHXNDb+ZiE7xFftKipUWAWIFG/nak27joQ6dCGqK6tB7SYI2/xmCbYicGybFtgKN1vMszxSue5C3kvAq/9ISnL+rTs63Cn/u9XPXiIxxZytqXIMvI/VcTj+nv34/Q8KJs1w1uGuBdLTSEBsa0lMlZBUU6LyLlAAvJhhUCkW9HpNYhBMtDiyvnlldOukExXIsU83MLhDcPIMZ2ey2+IGPWp+MvM8jssFqF7ne7A7RV6xVL5ZZLUp7IBokh+IDhEo9frDgfdqGD8dcfcj/qgo+7kOHNcI5+IFlbv6ca2T6aAWsMv3e4FkFSPgipDDlWv55hoeTQZZqflFlxJ5KUAGjpZbJ2YW7FzoecOVfI2agedni/VC6E8rYbZDNGbdxkwoCjCJl5v+gGqBJiyIND8a7vBMptbzhG08xMLLlfWzmA7KdpHEInIV0NZEiY9mDb6SOzuaGcyqrtzKZQ0DX0YVzezicUcll2IiSGUuzllhxiPobOGEAuvDFME/HtZ6k1D2nVRbLN/HtSE=
      on_success: always
      on_failure: always
      template:
        - "Repo `%{repository_slug}` *%{result}* build (<%{build_url}|#%{build_number}>) for commit (<%{compare_url}|%{commit}>) on branch `%{branch}`."
        - "Execution time: *%{duration}*"
        - "Commit message: %{commit_message}"
        - "Message: %{message}"